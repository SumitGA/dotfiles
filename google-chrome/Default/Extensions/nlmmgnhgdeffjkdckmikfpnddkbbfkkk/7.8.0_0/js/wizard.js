/*!
 * @package Autofill
 * @author T. H. Doan
 * @copyright (c) 2010-2017
 * @link http://www.tohodo.com/
 */
var Wizard=function(){var t=document,i=t.createElement("div"),n=t.createElement("select"),f=t.createElement("strong"),r=[{k:"",n:chrome.i18n.getMessage("optionsProfilesMenuUnfiled")}],u=+oLS.catnow>2?+oLS.catnow-4:0,c,e=oLS.cats?JSON.parse(oLS.cats):[],l=oLS.other?JSON.parse(oLS.other):{},o=chrome.i18n.getMessage("buttonsGenerateRules"),s=chrome.i18n.getMessage("buttonsGenerateRulesTT"),h=chrome.runtime.getManifest().name+": ",a=chrome.runtime.connect({name:"wizard"});return{show:function(){var u="autofill-wizard",r=t.createDocumentFragment(),l=t.createElement("img"),v=t.createElement("span"),c=t.createElement("span"),y=t.createElement("span"),e=t.createElement("button"),h=t.createElement("a");i.id=u;i.onselectstart=function(){return!1};l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAABGdBTUEAALGPC/xhBQAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuNUmK/OAAAAJQSURBVDhPrdLfS1NhGAfwbdoPotsQCm+C6HnPOXOjRCKU6CKiq7yLoKL+gALrIuiiHxeJFLNaDaNWuVqbU/crt9k2PRPnysVx2hxzwzZzW2RkSYOJ6dzTO0gwGDuDdeBcne/zOd/n5ZVIqnw+e0GacIOySkYimR8iRahtdhCOVIWleEaa9JBLcRcZjw5ArSiGeGprqVDGx8mSXraNQr8jdnJaHCq07sC1kw8we2L75nBmpEE25+Uux13MWthGIpMW8s/3kjBmj1/EH8fW8cvRsxuBtE9RM+eVX4+72PxHK1MQ+sgZ8VaZ5j2YaVnAZDPmo4fiWaFxZ4pvqE165bdiLi4/ZWUwaCKh90ayrSyGMwelhViTOh9twuWpRlwKHsCvo8prn9xyVdTBFUIWBimy7teTVtFWuZCC5CaUuaWgEr+NKZA2wtm33GrkDVsQ+hkMGAj6dMAPv4AtZbHFACtdDHCGBT+HaZ7DhIfDGQeLf9dC2gaHnsOqWwstoq3SPJGnhpmVhJvBmJPBsJ2g0E/wnZHgiA6QIuh4DL0DXSAVxehN1sacgNMUmTSTifEecPr1gHQldD0BtGkgZ3kIrCg0bYfdYRtkQ2bADyaIBE1QT88GaJscbYJmNaDpHmiMnRW0EvrgCgUw8Brmx/Swf+Pv1keg7r0PqL8LP1/egXrRVqOvQEbXEWiTX3w3HN48YFRBXXcHfNfehnZRqBjwaGEvXWdl8ClcKDXQdRPOa27AroowerDn6Kuza0BW0UC5kEEFV3s6oa5qqAg8a4d9/wP6A7lTLMr1Zo2FAAAAAElFTkSuQmCC";l.title=chrome.i18n.getMessage("wizardTitle");v.id=u+"-step1";v.textContent=chrome.i18n.getMessage(oLS.editable?"wizardFillField":"wizardFillForm");c.id=u+"-step2";c.innerHTML=chrome.i18n.getMessage("wizardChooseProfile")+": ";y.id=u+"-step3";Wizard.popCats();n.onchange=Wizard.selCat;n.setAttribute("accesskey","p");c.appendChild(n);e.id=u+"-create";e.innerHTML=oLS.editable?o.replace("Rules","Rule"):o;e.title=oLS.editable?s.replace("rules","rule"):s;e.onclick=Wizard.create;e.setAttribute("accesskey","g");y.appendChild(e);f.id=u+"-status";h.href="javascript:;";h.title=chrome.i18n.getMessage("buttonsClose");h.onclick=Wizard.close;h.textContent="Â ";r.appendChild(l);r.appendChild(v);r.appendChild(c);r.appendChild(y);r.appendChild(f);r.appendChild(h);i.appendChild(r);t.body.appendChild(i);setTimeout(function(){i.style.webkitTransform="inherit"},50);window.addEventListener("focus",Wizard.refresh);window.addEventListener("keydown",Wizard.handleKeyDown);a.onMessage.addListener(Wizard.handleMessage)},addCat:function(){var t=prompt(chrome.i18n.getMessage("wizardProfileName")+":"),i;if(t&&(t=t.replace(/^\s+|\s+$/g,"")),t)if(t.length>30)alert(h+chrome.i18n.getMessage("statusCharLimit")),n.selectedIndex=0;else if(/^(all|unfiled|manage\.\.\.|new\.\.\.)$/i.test(t))alert(h+chrome.i18n.getMessage("statusReserved")),n.selectedIndex=0;else{for(i=1;i<n.length;++i)if(n[i].text.toLowerCase()===t.toLowerCase()){alert(h+chrome.i18n.getMessage("statusDuplicate"));n.selectedIndex=i;return}chrome.runtime.sendMessage({type:"saveRules",data:{n:t}},function(n){e=n.data.cats;u=n.data.catnow-4;Wizard.popCats()})}else{n.selectedIndex=u;return}},popCats:function(){r.length=1;r=r.concat(e);r.push({k:"new",n:chrome.i18n.getMessage("wizardNew")});n.length=0;for(var i=0,f;i<r.length;++i)f=t.createElement("option"),f.value=r[i].k,f.text=r[i].n,f.setAttribute("data-site",r[i].s||""),n.add(f);n[n.length-1].style.color="#369";n.selectedIndex=u;c=n[n.selectedIndex].getAttribute("data-site")},selCat:function(){this.value==="new"?Wizard.addCat():(u=this.selectedIndex,c=this[this.selectedIndex].getAttribute("data-site"))},setStatus:function(n,t){f.className=n?"warning":"success";f.textContent=t},create:function(){chrome.runtime.sendMessage({type:"getRules",data:n.value})},close:function(){i.style.webkitTransform="translateY(-150%)";chrome.runtime.sendMessage({type:"resetFieldEP"});window.removeEventListener("focus",Wizard.refresh);window.removeEventListener("keydown",Wizard.handleKeyDown);a.disconnect();setTimeout(function(){var r=t.getElementsByTagName("style")[0];i.parentNode.removeChild(i);r&&r.textContent.indexOf("#autofill")>-1&&r.parentNode.removeChild(r);delete oFrag;delete oIcon;delete oStep1;delete oStep2;delete oStep3;delete n;delete oCreate;delete oClose;Wizard=undefined},400)},refresh:function(){chrome.runtime.sendMessage({type:"cat"},function(n){JSON.stringify(e)!==n.data.cats&&(e=JSON.parse(n.data.cats),u=Math.max(+n.data.catnow-4,0),Wizard.popCats())})},handleKeyDown:function(n){n.key==="Escape"&&Wizard.close()},handleMessage:function(n){var c,u,i,f;switch(n.type){case"createRules":var e=n.data,h=["elric","jeannie","merlin","sabrina","samantha","simon"],r=oLS.voice===undefined?1:+oLS.voice;e.length?(c=/([$^.?+*\\|(){}\[\]])/g,u=t.querySelector("#autofill-wizard-step3 > button"),u.disabled=!0,u.style.color="#999",chrome.runtime.sendMessage({type:"saveRules",data:{rules:e}}),Wizard.setStatus(0,chrome.i18n.getMessage("statusDone")),l.voice&&(i=new Audio(chrome.runtime.getURL("sounds/"+h[r<6?r:R(0,5)]+".ogg")),i.play(),delete i),setTimeout(Wizard.close,2e3)):(Wizard.setStatus(1,n.field?chrome.i18n.getMessage("statusEnterValue"):chrome.i18n.getMessage("statusNoChange")),l.voice&&(i=new Audio(chrome.runtime.getURL("sounds/"+h[r<6?r:R(0,5)]+"-err.ogg")),i.play(),delete i));break;case"updateWizard":f=t.getElementById("autofill-wizard-create");t.getElementById("autofill-wizard-step1").textContent=chrome.i18n.getMessage("wizardFill"+(n.field?"Field":"Form"));f.innerHTML=n.field?o.replace("Rules","Rule"):o;f.title=n.field?s.replace("rules","rule"):s;Wizard.setStatus(1,"")}}}}();Wizard.show(); 
