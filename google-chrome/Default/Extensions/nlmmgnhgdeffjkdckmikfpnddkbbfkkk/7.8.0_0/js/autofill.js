/*!
 * @package Autofill
 * @author T. H. Doan
 * @copyright (c) 2010-2017
 * @link http://www.tohodo.com/
 */
function init(n){(!oOther.manual||n)&&Autofill()}function initFields(n){for(var t,u,r,i=0;i<n.length;++i)t=n[i],u=oOther.backup&&t.type!=="password",t.nodeName==="IFRAME"?t.src.indexOf("javascript")===0&&(r=t.contentDocument,r.addEventListener("mousedown",handleMouseDown),u&&r.body&&r.body.addEventListener("input",backupField)):(t.initialValue=t.type==="checkbox"||t.type==="radio"?t.checked:t.isContentEditable?t.innerHTML:t.value,u&&(t.initialClass=t.className,t.addEventListener("input",backupField)))}function addRule(n){var i,t,u,r;return oET?(u=location.host||D.URL.replace(/^.+\/(.+)/,"$1"),oET.type!==undefined?(i=oET.name||oET.id||oET.placeholder||oET.title||oET.initialClass||oET.className,t=oET.value):oET.isContentEditable&&oET.textContent.trim()?(i=oET.id||oET.title||oET.initialClass||oET.className,t=oET.innerHTML.replace(/\\n/g,"\\n")):oET.nodeName==="IFRAME"&&(r=oET.contentDocument,r.body&&(t=r.body.innerHTML,/<script/i.test(t)?i=t="":(i=oET.name||oET.id||oET.title||oET.className||oET.src,t=t.replace(/\\n/g,"\\n")))),i&&t?[{t:0,n:i,v:t,s:u,c:n}]:[]):[]}function addRules(n){for(var t,c,f,r,u,o=location.host||D.URL.replace(/^.+\/(.+)/,"$1"),e=[],a=D.getElementsByTagName("input"),v=D.getElementsByTagName("textarea"),y=D.getElementsByTagName("select"),p=D.getElementsByTagName("iframe"),w=queryBySelector("[contenteditable=true]"),s={},i=0;i<a.length;++i)if(t=a[i],f=t.type,f!=="hidden"&&t.value){f!=="password"&&f!=="checkbox"&&f!=="radio"&&f!=="button"&&f!=="image"&&f!=="reset"&&f!=="submit"&&(f="text");r=t.name||t.id||t.placeholder||t.title||t.className;switch(f){case"text":r&&t.value!==t.initialValue&&e.push({t:0,n:r,v:t.value,s:o,c:n});break;case"password":t.value&&t.value!==t.initialValue&&e.push({t:1,n:r,v:t.value,s:o,c:n});break;case"checkbox":r&&t.checked!==t.initialValue&&e.push({t:3,n:r,v:""+ +t.checked,s:o,c:n});break;case"radio":s[r]===undefined?s[r]=""+ +t.checked:s[r]+=""+ +t.checked}}for(i in s)s[i].indexOf("1")>-1&&e.push({t:3,n:i,v:s[i],s:o,c:n});for(i=0;i<y.length;++i)if(t=y[i],r=t.name||t.id||t.title||t.className,r&&t.value!==t.initialValue){if(t.multiple){u="";for(var h=0,l=t.length,b=0;h<l;++h)t[h].selected&&(u+=" "+h,++b),h+1===l&&b===l&&(u="1!");u=u.slice(1)}else u=""+t.selectedIndex;e.push({t:2,n:r,v:u,s:o,c:n})}for(i=0;i<v.length;++i)t=v[i],r=t.name||t.id||t.placeholder||t.title||t.className,r&&t.value!==t.initialValue&&e.push({t:0,n:r,v:t.value,s:o,c:n});for(i=0;i<w.length;++i)(t=w[i],t.textContent.trim())&&(r=t.id||t.title||t.className,u=t.innerHTML.replace(/\\n/g,"\\n"),r&&t.innerHTML!==t.initialValue&&e.push({t:0,n:r,v:u,s:o,c:n}));for(i=0;i<p.length;++i)(t=p[i],!t.src||/^(about|javascript)/i.test(t.src)||t.src.indexOf(D.origin)===0)&&(c=t.contentDocument,u=c.body?c.body.innerHTML:"",!/<script/i.test(u)&&c.body.textContent.trim())&&(r=t.name||t.id||t.title||t.className||t.src,u=u.replace(/\\n/g,"\\n"),r&&u&&e.push({t:0,n:r,v:u,s:o,c:n}));return e}function Autofill(n,t){var i,w,s,h,r,y,c,p=t instanceof Array?t:queryBySelector(sFields),b,ft={},o,ht=/\s|<\/?(br|p) ?\/?>|<.+?> *<.+?>/gi,l=0,g={},e=oLS.rules?JSON.parse(oLS.rules):{},nt=n||+oLS.catnow||1,ct=oLS.exceptions?JSON.parse(oLS.exceptions):[],tt=oOther.overwrite,a,lt=/^(.*)\(\?<([!=])([^)]+)\)(.+)$/,at="abcdefghijklmnopqrstuvwxyz",vt="0123456789",et=at+at.toUpperCase()+vt+vt,it=function(n){var t,r,i;return a.length?(t=n.name+"\n"+n.id+"\n"+n.placeholder+"\n"+n.title+"\n"+n.className,new RegExp(a[1]+a[4],"im").test(t)?(i=new RegExp(a[1].replace(/\.\.$/,".+")+"("+a[3]+")"+a[4],"im"),a[2]==="="?i.test(t):!i.test(t)):!1):(t=(n.name||n.id||n.placeholder||n.title||n.className).trim(),n.type==="radio"&&(r=new RegExp(o,"m"),r.test(t+"\n"+n.value)))||o.test(t)||n.parentNode&&n.parentNode.nodeName==="LABEL"&&o.test(n.parentNode.textContent)||n.src&&o.test(n.src)?!0:oOther.labelmatch?findText(n,o):void 0},rt=function(){var t,i,h,c,f,l,a,v,s,n,o;if(oOther.vars){if((i=/\{-?\d+(\+\+|--)\}/g).test(r)){for(c=r,t=r.match(i),n=0;n<t.length;++n)i=new RegExp(t[n].replace(/(\+\+|--)/,"($1)").replace("++","\\+\\+")),h=+t[n].replace(/^\{(-?\d+)\D+/,"$1"),r=r.replace(i,h),c=c.replace(i,"{"+(t[n].indexOf("--")<0?++h:--h)+"$1}");chrome.runtime.sendMessage({type:"deincrement",data:{rule:u,value:c}})}if((i=/\{[nv]\d+\}/g).test(r))for(t=r.match(i),n=0;n<t.length;++n)i=new RegExp(t[n]),f=t[n].replace(/\D+/g,""),l=t[n].slice(1,2),e["r"+f]&&e["r"+f][l]!==undefined&&(r=r.replace(i,l==="v"&&ft["r"+f]?ft["r"+f]:e["r"+f][l]));if((i=/\{[^|}\r\n]+(\|[^|}\r\n]*)+\}/g).test(r))for(t=r.match(i),n=0;n<t.length;++n)i=new RegExp(t[n].replace(/\|/g,"\\|")),a=t[n].substring(1,t[n].length-1).split("|"),r=r.replace(i,a[R(0,a.length-1)]);if((i=/\{[#$]\d*\}/g).test(r))for(t=r.match(i),n=0;n<t.length;++n){if(i=new RegExp(t[n].replace("$","\\$")),v=+t[n].replace(/\D/g,"")||1,t[n].indexOf("#")>0)for(s=R(1,9),o=1;o<v;++o)s+=""+R(0,9);else for(s=et.charAt(R(0,51)),o=1;o<v;++o)s+=et.charAt(R(0,et.length-1));r=r.replace(i,s)}}return r},ot,v,u,yt,k,f,d,ut,st,pt;for(log=function(n,t){if(oOther.debug){var i="[Autofill] Rule "+n.replace("r","n")+' in profile "'+(oCats[e[n].c]?oCats[e[n].c].n:"Unfiled")+'"';t instanceof HTMLElement?console.log(i+" autofilled this field:",t):console.log(i+" executed this JavaScript:",t)}},v=0;v<ct.length;++v)if(o=new RegExp(cleanRE(ct[v]),"i"),o.test(D.title)||o.test(D.URL)){updateCount(p.length,0);return}if(w=nt>2?aCats[nt-5].k:nt===1?"all":"",w&&w!=="all"){if(ot=D.URL+" "+D.title,ot+=D.URL.indexOf("://www.")<0?" "+D.URL.replace("://","://www."):" "+D.URL.replace("://www.","://"),o=new RegExp(aCats[nt-5].s||".","i"),!o.test(ot)){updateCount(p.length,0);return}tt=aCats[nt-5].o||0}for(p.length||p.push(document.createElement("input")),v=0;v<p.length;++v)if(i=p[v],!i.disabled&&!i.readOnly){s=i.type;for(u in e){switch(e[u].t){case 0:if(s==="checkbox"||s==="radio"||s==="select-one"||s==="select-multiple"||s==="button"||s==="image"||s==="reset"||s==="submit"||s==="password")continue;break;case 1:if(s!=="password")continue;break;case 2:if(i.nodeName!=="SELECT")continue;break;case 3:if(s!=="checkbox"&&s!=="radio")continue}if(w==="all"&&e[u].c||oOther.backup&&oCats[e[u].c]&&oCats[e[u].c].n.indexOf("Backup - ")===0){if(o=new RegExp(oCats[e[u].c].s||".","i"),!(o.test(D.title)||o.test(D.URL)))continue;tt=oCats[e[u].c].o||0}else if(w!=="all"&&w!==e[u].c)continue;if(o=new RegExp(e[u].s.replace(/\n/g,"|")||".","i"),o.test(D.title)||o.test(D.URL)){h=e[u].n;r=""+e[u].v;a=[];lt.test(h)&&(a=h.match(lt),h="");o=new RegExp(cleanRE(h),"i");switch(e[u].t){case 2:if(yt=new Event("change"),k=function(n){n.dispatchEvent(yt);log(u,n);++l},it(i))if(r=rt().replace(/^\s+|\s+$/g,"").toLowerCase(),r.indexOf("|")<0&&/[^\d!? ]|^0\w/.test(r)){for(/^"\d+"$/.test(r)&&(r=r.replace(/"/g,"")),f=0;f<i.length;++f)if(r===i[f].text.toLowerCase()||r===i[f].value.toLowerCase()){i[f].selected=!0;k(i);break}}else if(r==="?")i.selectedIndex=R(0,i.options.length-1),k(i);else if(isNaN(r))if(/^([01]?!|)$/.test(r)){for(f=0;f<i.length;++f)switch(r==="!"||r==="1!"){case!0:i[f].selected||(i[f].selected=!0);break;case!1:i[f].selected&&(i[f].selected=!1)}k(i)}else{for(c=r.replace(/\s*[ |]\s*/g,"|").split("|"),i.selectedIndex=-1,f=0;f<c.length;++f)if(isNaN(c[f])||!i[c[f]]||i[c[f]].selected){if(isNaN(c[f]))for(d=0;d<i.length;++d)(c[f]===i[d].text.toLowerCase()||c[f]===i[d].value.toLowerCase())&&(i[d].selected=!0)}else i[c[f]].selected=!0;k(i)}else i.selectedIndex!=r&&(i.selectedIndex=r,k(i));break;case 3:it(i)&&(r===i.value?l+=toggle(i,1,u):(y=r.replace(/\s+/g,""),y==="?"?l+=toggle(i,R(0,1),u):y.length>1&&y.indexOf("!")<0?(g[h]===undefined?g[h]=0:++g[h],g[h]<y.length&&(l+=toggle(i,+y.charAt(g[h]),u))):l+=toggle(i,parseInt(y),u)));break;case 4:b===undefined&&(b={});b[u]=rt();break;default:if(i.nodeName==="INPUT"||i.nodeName==="TEXTAREA")(tt||!i.value)&&it(i)&&(i.value=rt(),i.dispatchEvent(new Event("input")),oOther.vars&&e[u].v.indexOf("{")>-1&&(ft[u]=i.value),log(u,i),++l);else if(i.isContentEditable)it(i)&&(tt||!i.innerHTML.replace(ht,""))&&(i.innerHTML=rt(),log(u,i),++l);else if(i.nodeName==="IFRAME"){if(i.src&&!/^(about|javascript)/i.test(i.src)&&i.src.indexOf(D.origin)!==0)continue;e[u].t===0&&it(i)&&(ut=i.contentDocument,ut.body&&(st=ut.body.innerHTML,/<script/i.test(st)||!tt&&st.replace(ht,"")||(pt=rt(),setTimeout(function(){ut.body.innerHTML=pt},100),log(u,ut.body),++l)))}}}}}b&&!t&&(D.readyState==="complete"?executeJs(b):window.addEventListener("load",function(){executeJs(b)}));updateCount(p.length,l)}function backupField(){var t,i,n;if(getField(this),t=oET.contentDocument,i=t&&t.body?t.body.innerHTML:oET.value||oET.innerHTML,!(i.length<oLS.backup)){var r=location.host.replace(/^www\./,""),u="Backup - "+r,f,e=!0;for(n=0;n<aCats.length;++n)if(aCats[n].n===u){f=aCats[n].k;e=!1;break}e?chrome.runtime.sendMessage({type:"saveRules",data:{n:u,s:r}},function(n){aCats=n.data.cats;saveRule(n.data.cat)}):saveRule(f)}}function cleanRE(n){return n=n.replace(/\/\*.*?\*\/\s*/g,""),n||"."}function clearHighlight(){oETPrev&&(oETPrev.style.backgroundColor="",oETPrev=undefined)}function executeJs(n){var r=0,t;for(var i in n)try{t='"use strict";'+n[i];eval(t);oOther.debug&&log(i,t);++r}catch(u){console.warn("["+chrome.runtime.getManifest().name+"] The following JavaScript code was not executed: "+n[i]+"\n  Error: "+u.message+"\n  Frame: "+D.URL)}updateCount(0,r)}function findText(n,t){var i=!1,u=!1,r=function(t,e){for(var o;t;){switch(t.nodeType){case 1:t.lastChild&&(t.nodeName!=="SELECT"&&n.nodeName!=="IFRAME"&&t.nodeName.indexOf("SCRIPT")<0||n.nodeName==="IFRAME"&&t.nodeName!=="DIV"&&t.nodeName.slice(0,1)!=="H")?r(t.lastChild,e):f(t,e);break;case 3:if(t.textContent.replace(/\W+/,""))if(e.test(t.textContent))i=!0;else if(n.parentNode.nodeName!=="TD"||n.nodeName==="IFRAME"||u)i=null;else{for(u=!0,o=n.parentNode.previousSibling;o&&!o.lastChild;)o=o.previousSibling;o&&o.lastChild?r(o.lastChild,e):i=null}else f(t,e)}if(i||i===null)break;t=t.previousSibling}},f=function(n,t){if(n.parentNode&&!n.previousSibling){for(var i=n.parentNode;i&&!i.previousSibling;)i=i.parentNode;i&&i.previousSibling&&r(i.previousSibling,t)}};return r(n,t),i||!1}function getField(n){var t=n;if(oET=n,!t.type){if(t.nodeName==="HTML")t=t.ownerDocument.body;else while(t){if(t.getAttribute("contenteditable")==="true"||t.nodeName==="BODY")break;t=t.parentNode}oET=t.ownerDocument.defaultView.frameElement||t}return t}function queryBySelector(n,t){return[].slice.call((t||D).querySelectorAll(n))}function R(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function saveRule(n){var t=addRule(n);t.length&&(t[0].s="",chrome.runtime.sendMessage({type:"saveRules",data:{rules:t}}),oET=undefined)}function toggle(n,t,i){var r=0;switch(t){case 0:n.checked&&(n.click(),log(i,n),++r);break;case 1:n.checked||(n.click(),log(i,n),++r)}return r}function updateCount(n,t){chrome.runtime.sendMessage({type:"count",data:{fields:n,filled:t}},updateIcon)}function updateIcon(){chrome.runtime.sendMessage({type:"icon"})}function updateOptions(n){oLS=n.data;oOther=oLS.other?JSON.parse(oLS.other):{};aCats=oLS.cats?JSON.parse(oLS.cats):[];oCats={};for(var t=0;t<aCats.length;++t)oCats[aCats[t].k]={n:aCats[t].n,s:aCats[t].s||"",o:aCats[t].o||0};oOther.menu?window.addEventListener("mousedown",handleMouseDown):window.removeEventListener("mousedown",handleMouseDown);bRightClicked=!1}function handleMessage(n,t,i){var r,u,f;switch(n.type){case"autofill":try{updateOptions(n);init(!0)}catch(e){return}break;case"create":r=oLS.editable?addRule(n.cat):addRules(n.cat);r.length&&chrome.runtime.sendMessage({type:"setRules",data:r});i({field:oLS.editable});break;case"resetFieldCS":clearHighlight();break;case"resetRightClickCS":bRightClicked=!1;break;case"showWizard":if(bRightClicked===undefined){self===top&&alert(chrome.runtime.getManifest().name+": "+chrome.i18n.getMessage("statusPageStillLoading"));return}for(u in n.data)oLS[u]=n.data[u];oLS.editable&&!oET&&(D.activeElement.nodeName==="INPUT"||D.activeElement.nodeName==="TEXTAREA")&&(oET=D.activeElement,bRightClicked=!0);clearHighlight();bRightClicked&&oLS.editable?(f=getField(oET),f.style.backgroundColor="#cadbf2",oETPrev=f):oET=undefined;D.getElementById("autofill-wizard")?chrome.runtime.sendMessage({type:"updateWizard",data:oLS.editable}):self===top&&i({});break;case"updateOptions":updateOptions(n)}}function handleKeyUp(n){if(n.altKey){var t;switch(n.key){case"1":t=5;break;case"2":t=6;break;case"3":t=7;break;case"4":t=8;break;case"5":t=9;break;case"6":t=10;break;case"7":t=11;break;case"8":t=12;break;case"9":t=13;break;case"0":t=14}t&&t<aCats.length+5&&(oLS.catnow=t,Autofill())}}function handleMouseDown(n){n.which===3&&(oET=n.target,chrome.runtime.sendMessage({type:"resetRightClickEP"},function(){bRightClicked=!0}))}var D=document,observer,sFields="input,select,textarea,[contenteditable=true],iframe",aCats,oCats,oLS,oOther,oET,oETPrev,bAltDown,bRightClicked,log;chrome.runtime.sendMessage({type:"init"},function(n){var t=queryBySelector(sFields);updateOptions(n);updateCount(t.length,0);initFields(t);oOther.delay?setTimeout(init,oLS.delay*1e3):init();oOther.manual||(observer=new MutationObserver(function(n){var t=[];n.forEach(function(n){var f=n.addedNodes.length,u,i,r;if(f)for(u=0;u<f;++u)(i=n.addedNodes[u],r=[],i.nodeType===1&&i.id!=="autofill-wizard")&&(i.children&&i.children.length?(r=queryBySelector(sFields,i),t=t.concat(r)):(sFields.indexOf(i.nodeName.toLowerCase())>-1||i.getAttribute("contenteditable")==="true")&&t.indexOf(i)<0&&r.push(i),r.length&&(Autofill(null,r),setTimeout(function(){initFields(r)},1e3)))})}),observer.observe(D.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))});chrome.runtime.onMessage.addListener(handleMessage);window.addEventListener("beforeunload",function(){chrome.runtime.sendMessage({type:"resetCount"})});window.addEventListener("keyup",handleKeyUp); 
